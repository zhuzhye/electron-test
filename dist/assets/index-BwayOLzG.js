import{_ as X}from"./_plugin-vue_export-helper-CtXoblKC.js";import{T as $e}from"./index-DY1Jh4IR.js";/* empty css                     */import{I as Ne,j as I,d as Z,s as W,i as R,J as Q,c as j,f as l,w as o,k as t,K as A,L as ne,o as y,e as $,g as w,F as Ie,a as Oe,b as x,n as M,M as ee,N as pe,O as me,P as Re,Q as ce,S as Fe,l as Le,T as Se,U as he,V as ye,W as ze,X as Ue,t as H,Y as Me,Z as Ye,_ as Be,$ as Ae,a0 as Ge,a1 as He,a2 as se,p as xe,A as je,B as Qe}from"./index-8OAU0V6z.js";import{h as N,C as ue,t as De}from"./index-BVlh-Z3s.js";/* empty css                       */const le=Ne("tsServices",{state:()=>({commandModal:!1,historyModal:!1,historySplitModal:!1,addServerModal:!1,modifyConditionModal:!1,testFlowModal:!1}),actions:{}}),Je=a=>I(()=>a===0?"添加服务器":a===1?"修改服务":a===2?"添加服务器":"修改服务器"),Ke=a=>(console.log(a,"type"),a===0?[{value:"web",label:"web"},{value:"pgsql",label:"pgsql"},{value:"mysql",label:"mysql"},{value:"redis",label:"redis"},{value:"nginx",label:"nginx"},{value:"fastfds",label:"fastfds"},{value:"mq",label:"mq"},{value:"tomcat",label:"tomcat"},{value:"其他类型",label:"其他类型"}]:[{value:"server",label:"server"},{value:"windows",label:"windows"}]);var we=(a=>(a[a.AddLow=0]="AddLow",a[a.EditLow=1]="EditLow",a[a.AddNew=2]="AddNew",a[a.Edit=3]="Edit",a))(we||{});const We=()=>N.request({url:"/service/getTree",method:"GET"},{isShowSuccessMessage:!1}),Xe=a=>N.request({url:"/service/getCommond",method:"GET",params:a},{isShowSuccessMessage:!1}),Ze=a=>N.request({url:"/service/arrangement",method:"POST",headers:{"Content-type":ue.FORM_DATA},params:De(a)},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),el=a=>N.request({url:"/servicesStatus/selectLike",method:"GET",params:a},{isShowSuccessMessage:!1,isShowErrorMessage:!0}),ll=a=>N.request({url:"/service",method:"POST",params:De(a),headers:{"Content-type":ue.FORM_DATA}},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),tl=a=>N.request({url:"/service/getServiceById",method:"GET",params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0,isReturnNativeResponse:!0}),ol=a=>N.request({url:"/service/delete",method:"GET",params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),al=a=>N.request({url:"/service/rebootService",method:"POST",headers:{"Content-type":ue.FORM_DATA},params:a},{isShowErrorMessage:!0,isReturnNativeResponse:!0}),rl=a=>N.request({url:"/service/refresh",method:"GET",params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),sl=a=>N.request({url:"/service/updateIsSchedule",method:"POST",headers:{"Content-type":ue.FORM_DATA},params:a},{isReturnNativeResponse:!0}),nl=a=>N.request({url:"/service/updateBindState",method:"GET",params:a},{isReturnNativeResponse:!0}),ul=a=>N.request({url:"/service/getServiceConditionsById",method:"GET",params:a},{isReturnNativeResponse:!0}),dl=a=>N.request({url:"/service/saveConditionsById",method:"POST",headers:{"Content-type":ue.FORM_DATA},params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),il=a=>N.request({url:"/service/testNetStatus",method:"POST",headers:{"Content-type":ue.FORM_DATA},params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),pl=a=>N.request({url:"/service/testFlow",method:"GET",params:a},{isShowSuccessMessage:!0,isShowErrorMessage:!0}),ml=a=>N.request({url:"/service/lookLog",method:"GET",params:a},{isReturnNativeResponse:!0}),cl={class:"addserver-dialog"},fl={class:"dialog-footer"},vl=Z({__name:"index",props:{currentRow:{type:Object,delfalut:()=>{}},addType:{type:Number,default:0}},emits:["getTableData"],setup(a,{expose:h,emit:p}){let{addServerModal:m}=W(le());const u=R(),e=a;let f=I(()=>Je(e.addType)),S=I(()=>Ke(e.addType));const D=p,T=Q({name:[{required:!0,message:"该选项必填",trigger:"blur"}],serverAddress:[{required:!0,message:"该选项必填",trigger:"blur"}],databaseName:[{required:!0,message:"数据库名称不能为空",trigger:"blur"}],scriptPath:[{required:!0,message:"jar包路径不能为空",trigger:"blur"}],username:[{required:!0,message:"该选项必填",trigger:"blur"}],passward:[{required:!0,message:"该选项必填",trigger:"blur"}]});let s=Q({id:"",name:"",serviceType:"",scriptPath:"",oomPath:"",databaseName:"",serverAddress:"",username:"",passward:"",logsLocation:"",telePhone:"",heartPath:"",remark:"",cusCommand:"",pid:""});const g=async()=>{e.currentRow&&(e.addType===we.AddLow?s.pid=e.currentRow.id:e.addType===we.EditLow?(s.pid=e.currentRow.pid,s.id=e.currentRow.id,s._method="PUT"):e.addType===we.Edit&&(s._method="PUT",s.id=e.currentRow.id)),u.value&&u.value.validate(async C=>{C&&(await ll(s)).code===200&&(D("getTableData"),k())})},V=C=>{for(let i in s)s[i]=C[i]},k=()=>{console.log(S,"serverSelectList"),u.value&&(u.value.resetFields(),m.value=!1)};return h({setFormData:V}),(C,i)=>{const F=ee,c=pe,v=me,L=Fe,B=Re,Y=ce,te=ne;return y(),j("div",cl,[l(te,{modelValue:t(m),"onUpdate:modelValue":i[13]||(i[13]=_=>A(m)?m.value=_:m=_),title:t(f).value,width:"700",top:"10vh",draggable:"",onClose:k},{footer:o(()=>[$("div",fl,[l(F,{onClick:k},{default:o(()=>[w("取消")]),_:1}),l(F,{color:"#009688",onClick:g},{default:o(()=>[w(" 保存 ")]),_:1})])]),default:o(()=>[l(Y,{model:t(s),"label-width":"auto",class:"form-dialog",rules:T,ref_key:"formRef",ref:u},{default:o(()=>[l(v,{label:"服务名",prop:"name"},{default:o(()=>[l(c,{modelValue:t(s).name,"onUpdate:modelValue":i[0]||(i[0]=_=>t(s).name=_),placeholder:"请输入服务名",size:"large"},null,8,["modelValue"])]),_:1}),l(v,{label:"服务类型",prop:"serviceType"},{default:o(()=>[l(B,{modelValue:t(s).serviceType,"onUpdate:modelValue":i[1]||(i[1]=_=>t(s).serviceType=_),placeholder:"--请输入服务类型--",size:"large",style:{width:"200px"}},{default:o(()=>[(y(!0),j(Ie,null,Oe(t(S),_=>(y(),x(L,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(s).serviceType==="web"?(y(),x(v,{key:0,label:"jar路径",prop:"scriptPath"},{default:o(()=>[l(c,{modelValue:t(s).scriptPath,"onUpdate:modelValue":i[2]||(i[2]=_=>t(s).scriptPath=_),placeholder:"请输入路径",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0),t(s).serviceType==="web"?(y(),x(v,{key:1,label:"内存溢出路径",prop:"oomPath"},{default:o(()=>[l(c,{modelValue:t(s).oomPath,"onUpdate:modelValue":i[3]||(i[3]=_=>t(s).oomPath=_),placeholder:"请输入内存溢出路径",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0),t(s).serviceType==="mysql"?(y(),x(v,{key:2,label:"名称",prop:"databaseName"},{default:o(()=>[l(c,{modelValue:t(s).databaseName,"onUpdate:modelValue":i[4]||(i[4]=_=>t(s).databaseName=_),placeholder:"请输入数据库名称",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0),l(v,{label:"地址及端口",prop:"serverAddress"},{default:o(()=>[l(c,{modelValue:t(s).serverAddress,"onUpdate:modelValue":i[5]||(i[5]=_=>t(s).serverAddress=_),placeholder:"形如188.188.1.1:22",size:"large"},null,8,["modelValue"])]),_:1}),l(v,{label:"账号",prop:"username"},{default:o(()=>[l(c,{modelValue:t(s).username,"onUpdate:modelValue":i[6]||(i[6]=_=>t(s).username=_),placeholder:"请输入账号",size:"large"},null,8,["modelValue"])]),_:1}),l(v,{label:"密码",prop:"passward"},{default:o(()=>[l(c,{modelValue:t(s).passward,"onUpdate:modelValue":i[7]||(i[7]=_=>t(s).passward=_),placeholder:"请输入密码",size:"large",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(s).serviceType==="web"?(y(),x(v,{key:3,label:"日志路径",prop:"logsLocation"},{default:o(()=>[l(c,{modelValue:t(s).logsLocation,"onUpdate:modelValue":i[8]||(i[8]=_=>t(s).logsLocation=_),placeholder:"形如 /usr/local/application/xxx/logs",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0),t(s).serviceType==="web"?(y(),x(v,{key:4,label:"心跳存取路径",prop:"heartPath"},{default:o(()=>[l(c,{modelValue:t(s).heartPath,"onUpdate:modelValue":i[9]||(i[9]=_=>t(s).heartPath=_),placeholder:"形如 /usr/local/application/xxx/logs/xxx.log",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0),l(v,{label:"联系电话",prop:"telePhone"},{default:o(()=>[l(c,{modelValue:t(s).telePhone,"onUpdate:modelValue":i[10]||(i[10]=_=>t(s).telePhone=_),placeholder:"请输入联系电话",size:"large"},null,8,["modelValue"])]),_:1}),l(v,{label:"服务备注",prop:"remark"},{default:o(()=>[l(c,{modelValue:t(s).remark,"onUpdate:modelValue":i[11]||(i[11]=_=>t(s).remark=_),placeholder:"请输入服务备注",size:"large"},null,8,["modelValue"])]),_:1}),t(s).serviceType==="其他类型"?(y(),x(v,{key:5,label:"自定义命令",prop:"cusCommand"},{default:o(()=>[l(c,{modelValue:t(s).cusCommand,"onUpdate:modelValue":i[12]||(i[12]=_=>t(s).cusCommand=_),placeholder:"请输入自定义命令",size:"large"},null,8,["modelValue"])]),_:1})):M("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),gl=X(vl,[["__scopeId","data-v-a966fa62"]]),_l={class:"addserver-dialog"},bl={class:"dialog-footer"},wl=Z({__name:"index",setup(a,{expose:h}){const p=le(),{modifyConditionModal:m}=W(p);let u=R();const e=Q({cpu:"",hard:"",memory:"",part:"",boxSurvival:"",logsSize:"",ipsFlow:"",connectNum:""}),f=Q({cpu:[{required:!0,message:"该选项必填",trigger:"blur"}],hard:[{required:!0,message:"该选项必填",trigger:"blur"}],memory:[{required:!0,message:"该选项必填",trigger:"blur"}],part:[{required:!0,message:"该选项必填",trigger:"blur"}],boxSurvival:[{required:!0,message:"该选项必填",trigger:"blur"}],logsSize:[{required:!0,message:"该选项必填",trigger:"blur"}],ipsFlow:[{required:!0,message:"该选项必填",trigger:"blur"}],connectNum:[{required:!0,message:"该选项必填",trigger:"blur"}]}),S=async()=>{u.value&&u.value.validate(async s=>{s&&(await dl(e),m.value=!1,u.value&&u.value.resetFields())})},D=(s,g)=>{for(let V in s)e[V]=s[V];e.serviceId=g},T=()=>{m.value=!1,u.value&&u.value.resetFields()};return h({setFrom:D}),(s,g)=>{const V=ee,k=pe,C=me,i=ce,F=ne;return y(),j("div",_l,[l(F,{onClose:T,modelValue:t(m),"onUpdate:modelValue":g[8]||(g[8]=c=>A(m)?m.value=c:null),title:"修改条件",width:"500",top:"10vh",draggable:""},{footer:o(()=>[$("div",bl,[l(V,{onClick:T},{default:o(()=>[w("取消")]),_:1}),l(V,{color:"#009688",onClick:S},{default:o(()=>[w(" 保存 ")]),_:1})])]),default:o(()=>[l(i,{model:e,"label-width":"auto",class:"form-dialog",ref_key:"formRef",ref:u,rules:f},{default:o(()=>[l(C,{label:"CPU(%)",prop:"cpu"},{default:o(()=>[l(k,{modelValue:e.cpu,"onUpdate:modelValue":g[0]||(g[0]=c=>e.cpu=c),placeholder:"请输入CPU占用比",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"硬盘(G)",prop:"hard"},{default:o(()=>[l(k,{modelValue:e.hard,"onUpdate:modelValue":g[1]||(g[1]=c=>e.hard=c),placeholder:"请输入硬盘不足值(G)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"内存(N)",prop:"memory"},{default:o(()=>[l(k,{modelValue:e.memory,"onUpdate:modelValue":g[2]||(g[2]=c=>e.memory=c),placeholder:"请输入内存不足值(M)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"分盘(%)",prop:"part"},{default:o(()=>[l(k,{modelValue:e.part,"onUpdate:modelValue":g[3]||(g[3]=c=>e.part=c),placeholder:"请输入分盘超出值(%)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"存活率(%)",prop:"boxSurvival"},{default:o(()=>[l(k,{modelValue:e.boxSurvival,"onUpdate:modelValue":g[4]||(g[4]=c=>e.boxSurvival=c),placeholder:"请输入盒子存活率(%)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"日志(G)",prop:"logsSize"},{default:o(()=>[l(k,{modelValue:e.logsSize,"onUpdate:modelValue":g[5]||(g[5]=c=>e.logsSize=c),placeholder:"请输入日志超出值(G)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"异常扣费(分次数)",prop:"ipsFlow"},{default:o(()=>[l(k,{modelValue:e.ipsFlow,"onUpdate:modelValue":g[6]||(g[6]=c=>e.ipsFlow=c),placeholder:"请输入(分钟,次数)",size:"large"},null,8,["modelValue"])]),_:1}),l(C,{label:"连接个数",prop:"connectNum"},{default:o(()=>[l(k,{modelValue:e.connectNum,"onUpdate:modelValue":g[7]||(g[7]=c=>e.connectNum=c),placeholder:"请输入超出连接数(个)",size:"large"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),yl=X(wl,[["__scopeId","data-v-67482ccc"]]),Sl={class:"addserver-dialog"},hl={class:"dialog-footer"},Cl=Z({__name:"index",setup(a,{expose:h}){const p=le(),m=Le(),u=W(m),{commandModal:e}=W(p),f=R();let S=Q({id:"",offCommond:"",rebootCommond:"",turnCommond:""});const D=Q({offCommond:[{required:!0,message:"该选项必填",trigger:"blur"}],rebootCommond:[{required:!0,message:"该选项必填",trigger:"blur"}],turnCommond:[{required:!0,message:"该选项必填",trigger:"blur"}]}),T=async()=>{f.value&&await f.value.validate(async g=>{g&&(S.user=u.userInfo.value.username,await Ze(S),f.value&&f.value.resetFields(),e.value=!1)})};return h({getCommondInfo:async g=>{S.id=g;const V=await Xe({id:g});V.data&&(S=Object.assign(S,V.data))}}),(g,V)=>{const k=ee,C=pe,i=me,F=ce,c=ne;return y(),j("div",Sl,[l(c,{modelValue:t(e),"onUpdate:modelValue":V[4]||(V[4]=v=>A(e)?e.value=v:null),title:"命令列表",width:"700",top:"10vh",draggable:""},{footer:o(()=>[$("div",hl,[l(k,{onClick:V[0]||(V[0]=()=>{var v;e.value=!1,(v=f.value)==null||v.resetFields()})},{default:o(()=>[w("取消")]),_:1}),l(k,{color:"#009688",onClick:T},{default:o(()=>[w(" 保存 ")]),_:1})])]),default:o(()=>[l(F,{model:t(S),rules:D,ref_key:"formRef",ref:f,"label-width":"auto",class:"form-dialog"},{default:o(()=>[l(i,{label:"开启",prop:"offCommond"},{default:o(()=>[l(C,{modelValue:t(S).offCommond,"onUpdate:modelValue":V[1]||(V[1]=v=>t(S).offCommond=v),size:"large"},null,8,["modelValue"])]),_:1}),l(i,{label:"关闭",prop:"rebootCommond"},{default:o(()=>[l(C,{modelValue:t(S).rebootCommond,"onUpdate:modelValue":V[2]||(V[2]=v=>t(S).rebootCommond=v),size:"large"},null,8,["modelValue"])]),_:1}),l(i,{label:"重启",prop:"turnCommond"},{default:o(()=>[l(C,{modelValue:t(S).turnCommond,"onUpdate:modelValue":V[3]||(V[3]=v=>t(S).turnCommond=v),size:"large"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Vl=X(Cl,[["__scopeId","data-v-58f3dd23"]]),kl={class:"addserver-dialog"},Tl={class:"dialog-footer"},Ml=Z({__name:"SplitInformation",setup(a,{expose:h}){const p=le(),{historySplitModal:m}=W(p);let u=R();const e=S=>{u.value=S},f=()=>{u.value=[],m.value=!1};return h({setTableData:e}),(S,D)=>{const T=ee,s=Se,g=he,V=ne;return y(),j("div",kl,[l(V,{modelValue:t(m),"onUpdate:modelValue":D[0]||(D[0]=k=>A(m)?m.value=k:null),title:"分盘详情",width:"100%",top:"11vh",onClose:f},{footer:o(()=>[$("div",Tl,[l(T,{color:"#009688",onClick:f},{default:o(()=>[w(" 关闭 ")]),_:1})])]),default:o(()=>[l(g,{style:{width:"100%"},"row-key":"id","tree-props":{children:"children"},"default-sort":{prop:"sort",order:""},"default-expand-all":"",border:"",data:t(u)},{default:o(()=>[l(s,{label:"分盘大小",prop:"fileSystem"}),l(s,{label:"总容量",prop:"total"}),l(s,{label:"已使用容量",prop:"used"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),xl=X(Ml,[["__scopeId","data-v-44d0dc7d"]]),zl=a=>a==="web"||a==="mq"||a==="redis"||a==="fastfds"||a==="nginx"||a==="mysql"?["cpuOccupancy","memoryOccupancy","hardOccupancy","netStatus","runTime","maxCpuPID","dateStr"]:[],Rl=()=>{const a=I(()=>function(e,f){return console.log(e.netStatus,f.serviceType,"rowDatarowData"),f.serviceType==="server"?f.isSchedule==="1"?String(e.netStatus)==="1"?{color:"red",label:"停止"}:String(e.netStatus)==="0"?String(e.avgTime)==="undefined"?{color:"#00FF00",label:"正常"}:{color:"#00FF00",label:"正常/"+e.avgTime+"ms"}:{color:"#0000FF",label:"未检测"}:{color:"#0000FF",label:""}:{color:"#0000FF",label:""}}),h=I(()=>function(e){return e==="1"?{color:"red",label:"停止"}:e==="0"?{color:"#00FF00",label:"正常"}:{color:"",label:""}}),p=I(()=>function(e){return e.split(",")[0]}),m=I(()=>function(e,f){return f&&f.serviceType==="web"?String(e.logsSize)==="undefined"?{color:"#00FF00",label:""}:{color:"#00FF00",label:e.logsSize}:{color:"#00FF00",label:""}}),u=I(()=>function(e){return e?ye(e).format("YYYY-MM-DD HH:mm:ss"):""});return{transNetStatus:a,transRunStatus:h,transServerAddress:p,transLogsSize:m,transCreateTime:u}},Fl={class:"addserver-dialog"},Ul={class:"dialog-footer"},Dl=Z({__name:"index",setup(a,{expose:h}){const p=le(),{historyModal:m,historySplitModal:u}=W(p);let e=Q({page:1,limit:10,total:0}),f=Q({page:I(()=>e.page),limit:I(()=>e.limit)}),S=R({}),D=R();const T=zl(S.value.serviceType),{transNetStatus:s,transRunStatus:g,transServerAddress:V,transLogsSize:k,transCreateTime:C}=Rl(),i=z=>{e.limit=z,c()},F=z=>{e.page=z,c()},c=async()=>{let z={};for(let G in f)G!=="time"&&(z[G]=f[G]);f.time&&f.time.length>0&&(z.startTime=ye(f.time[0]).format("YYYY-MM-DD HH:mm:ss"),z.endTime=ye(f.time[1]).format("YYYY-MM-DD HH:mm:ss"));const q=await el(z);D.value=q.data.list,e.total=q.data.count},v=z=>{f.id=z.id,S.value=z,c()},L=()=>{e.page=1,c()},B=R(),Y=()=>{e.page=1,console.log(B,"formRef"),B.value&&B.value.resetFields(),c()};let te=R();const _=z=>{var q;u.value=!0,(q=te.value)==null||q.setTableData(z)},de=()=>{m.value=!1,B.value&&B.value.resetFields(),D.value=[]};return h({getHistoryRecordRow:v}),(z,q)=>{const G=ee,fe=Fe,Ce=Re,oe=me,ve=Ye,Ve=ce,E=Se,ke=Be,ge=he,K=Ae,Te=ne;return y(),j("div",Fl,[l(Te,{modelValue:t(m),"onUpdate:modelValue":q[4]||(q[4]=O=>A(m)?m.value=O:null),title:"历史记录",width:"100%",top:"5vh",onClose:de,draggable:""},{footer:o(()=>[$("div",Ul,[l(G,{color:"#009688",onClick:de},{default:o(()=>[w(" 关闭 ")]),_:1})])]),default:o(()=>[l(Ve,{inline:!0,model:t(f),ref_key:"formRef",ref:B},{default:o(()=>[l(oe,{label:"运行状态",prop:"runStatus"},{default:o(()=>[l(Ce,{modelValue:t(f).runStatus,"onUpdate:modelValue":q[0]||(q[0]=O=>t(f).runStatus=O),placeholder:"——运行状态——",style:{width:"200px"},clearable:""},{default:o(()=>[l(fe,{key:"1",label:"停止",value:"1"}),l(fe,{key:"0",label:"正常",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(oe,{label:"时间",prop:"time"},{default:o(()=>[l(ve,{clearable:"",type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss",modelValue:t(f).time,"onUpdate:modelValue":q[1]||(q[1]=O=>t(f).time=O)},null,8,["modelValue"])]),_:1}),l(oe,null,{default:o(()=>[l(G,{type:"primary",onClick:L,icon:t(ze)},{default:o(()=>[w("查询")]),_:1},8,["icon"]),l(G,{onClick:Y,icon:t(Ue)},{default:o(()=>[w("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),l(ge,{style:{width:"100%"},"row-key":"id","tree-props":{children:"children"},"default-sort":{prop:"sort",order:""},"default-expand-all":"",border:"",data:t(D),"table-layout":"auto"},{default:o(()=>{var O,_e,ae,ie,be,d,n;return[l(E,{type:"selection",width:"55"}),l(E,{type:"index",label:"",width:"50",index:1}),l(E,{prop:"serverAddress",label:"服务地址"},{default:o(b=>[w(H(t(V)(b.row.serverAddress)),1)]),_:1}),l(E,{prop:"runStatus",label:"运行状态"},{default:o(b=>[$("span",{style:Me(`color:${t(g)(b.row.runStatus).color}`)},H(t(g)(b.row.runStatus).label),5)]),_:1}),(O=t(T))!=null&&O.includes("cpuOccupancy")?M("",!0):(y(),x(E,{key:0,prop:"cpuOccupancy",label:"CPU占用率"})),(_e=t(T))!=null&&_e.includes("memoryOccupancy")?M("",!0):(y(),x(E,{key:1,prop:"memoryOccupancy",label:"内存占用率"})),(ae=t(T))!=null&&ae.includes("hardOccupancy")?M("",!0):(y(),x(E,{key:2,prop:"hardOccupancy",label:"硬盘占用"})),(ie=t(T))!=null&&ie.includes("netStatus")?M("",!0):(y(),x(E,{key:3,prop:"netStatus",label:"网络状态"},{default:o(b=>[$("span",{style:Me(`color:${t(s)(b.row,t(S)).color}`)},H(t(s)(b.row,t(S)).label),5)]),_:1})),t(S).serviceType==="web"?(y(),x(E,{key:4,prop:"logsSize",label:"日志大小"},{default:o(b=>[$("span",{style:Me(`color:${t(k)(b.row,t(S)).color}`)},H(t(k)(b.row,t(S)).label),5)]),_:1})):M("",!0),l(E,{prop:"createTime",label:"更新时间"},{default:o(b=>[w(H(t(C)(b.row.createTime)),1)]),_:1}),(be=t(T))!=null&&be.includes("runTime")?M("",!0):(y(),x(E,{key:5,prop:"runTime",label:"运行时间"})),(d=t(T))!=null&&d.includes("maxCpuPID")?M("",!0):(y(),x(E,{key:6,prop:"maxCpuPID",label:"CPU占用最高的PID"})),(n=t(T))!=null&&n.includes("dateStr")?M("",!0):(y(),x(E,{key:7,prop:"dateStr",label:"服务器和系统时间",width:"150"})),l(E,{prop:"cusContent",label:"自定义命令内容"}),l(E,{prop:"action",label:"操作"},{default:o(b=>[l(ke,{color:"#FC764B",style:{color:"#fff"},onClick:re=>_(b.row.disks)},{default:o(()=>[w(" 分盘详细信息 ")]),_:2},1032,["onClick"])]),_:1})]}),_:1},8,["data"]),l(K,{class:"bt-page","current-page":t(e).page,"onUpdate:currentPage":q[2]||(q[2]=O=>t(e).page=O),"page-size":t(e).limit,"onUpdate:pageSize":q[3]||(q[3]=O=>t(e).limit=O),"page-sizes":[10,20,30,40],layout:" prev, pager, sizes,total, next, jumper",total:t(e).total,onSizeChange:i,onCurrentChange:F},null,8,["current-page","page-size","total"])]),_:1},8,["modelValue"]),l(xl,{ref_key:"SplitInformationRef",ref:te},null,512)])}}}),ql=X(Dl,[["__scopeId","data-v-93dd232d"]]),El={class:"addserver-dialog"},Pl={class:"dialog-footer"},$l={class:"search-box"},Nl=Z({__name:"index",emits:["testFlow"],setup(a,{expose:h,emit:p}){let u=R([]);const e=le(),{testFlowModal:f}=W(e),S=p;let D=R(""),T=R("");const s=(C,i)=>{D.value=i,u.value=[],u.value=Object.assign(u.value,C)},g=()=>{f.value=!1,D.value="",u.value=[]},V=()=>{let C=Number(T.value);C&&C>0?S("testFlow",D.value,C):S("testFlow",D.value)},k=I(()=>function(C){return C==="PM"?"下午":"上午"});return h({setTableData:s}),(C,i)=>{const F=ee,c=pe,v=Se,L=he,B=ne;return y(),j("div",El,[l(B,{modelValue:t(f),"onUpdate:modelValue":i[1]||(i[1]=Y=>A(f)?f.value=Y:null),title:"测试流量",width:"100%",top:"5vh",draggable:"",onClose:g},{footer:o(()=>[$("div",Pl,[l(F,{color:"#009688",onClick:g},{default:o(()=>[w(" 关闭 ")]),_:1})])]),default:o(()=>[$("div",$l,[l(c,{modelValue:t(T),"onUpdate:modelValue":i[0]||(i[0]=Y=>A(T)?T.value=Y:T=Y),class:"search-input",placeholder:"流量条数",size:"large"},null,8,["modelValue"]),l(F,{type:"primary",size:"large",icon:t(ze),onClick:V},{default:o(()=>[w("查询")]),_:1},8,["icon"])]),l(L,{data:t(u),border:"","table-layout":"auto",style:{width:"100%"}},{default:o(()=>[l(v,{prop:"b",label:""},{default:o(Y=>[w(H(k.value(Y.row.b)),1)]),_:1}),l(v,{prop:"a",label:"时间"}),l(v,{prop:"c",label:"网卡"}),l(v,{prop:"d",label:"接收的数据包"}),l(v,{prop:"e",label:"发送的数据包"}),l(v,{prop:"f",label:"接收的字节数"}),l(v,{prop:"g",label:"发送的字节数"}),l(v,{prop:"h",label:"接收的压缩数据包"}),l(v,{prop:"i",label:"发送的压缩数据包"}),l(v,{prop:"j",label:"接收的多播数据包"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),Il=X(Nl,[["__scopeId","data-v-d0d3245b"]]);function Ol(a){const h={},p=[];return a.forEach(m=>{h[m.id]={...m}}),console.log(h,"map"),a.forEach(m=>{if(m.pid==="-1"||!m.pid||m.pid==="undefined")p.push(h[m.id]);else{let u=h[m.pid];u.children?u.children.push(h[m.id]):h[m.pid].children=[h[m.id]]}}),p}const qe=(a,h)=>a.filter(p=>p.children&&p.children.length>0?qe(p.children,h).length>0:p.name.indexOf(h)>-1),Ll=()=>{const a=I(()=>function(u){return u==="0"?"正常":u==="1"?"停止":"未检测"}),h=I(()=>function(u){return u==="0"?"已绑定":"未绑定"}),p=I(()=>function(u){return String(u.serviceType)==="server"&&String(u.runStatus)==="0"?String(u.isSchedule)==="1"?String(u.netStatus)==="1"?{label:"停止",color:"red"}:String(u.netStatus)==="0"?String(u.avgTime)==="undefined"?{label:"正常",color:"green"}:{label:"正常/"+u.avgTime+"ms",color:"green"}:{label:"未检测",color:"blue"}:{label:"未开启",color:"blue"}:{label:"",color:""}}),m=I(()=>function(u){return ye(u).format("YYYY-MM-DD HH:mm:ss")});return{transRunStatus:a,transNetStatus:p,transServerBind:h,transTime:m}},Yl=a=>(je("data-v-4613a40b"),a=a(),Qe(),a),Bl={class:"action-box"},Al={key:0,class:"net-box"},Gl=Yl(()=>$("span",null,"服务名:",-1)),Hl={key:1,class:"net-box"},jl=Z({__name:"index",setup(a){let h=R(),p=R(),m=Q({});const u={showModal:!1,title:"",context:""};let e=Q({...u});const f=le(),{commandModal:S,historyModal:D,addServerModal:T,modifyConditionModal:s,testFlowModal:g}=W(f),{transRunStatus:V,transNetStatus:k,transServerBind:C,transTime:i}=Ll(),F=async()=>{const d=await We();d.data.list&&(h.value=Ol(d.data.list))};Ge(async()=>{F()});const c=()=>{if(h.value){const d=qe(h.value,m.name);h.value=d}},v=()=>{m.name="",F()};let L=R();const B=d=>{T.value=!0,L.value=0,p.value=d};let Y=R();const te=async d=>{var b;p.value=d,d.pid!=="-1"?L.value=1:L.value=2;const n=await tl({serviceId:d.id});(b=Y.value)==null||b.setFormData(n.data),T.value=!0},_=R(),de=async(d,n)=>{var re;g.value=!0;const b=await pl({serviceId:d,page:1,limit:10,dataNumber:n});(re=_.value)==null||re.setTableData(b.data.list,d)};let z=R("");const q=async d=>{p.value=d,e.showModal=!0,e.width="800",e.top="10vh",e.title="查看日志",e.type=5,z.value="",e.loading=!0;const n=await ml({serviceId:d.id});n.data&&(z.value=n.data),e.loading=!1};let G=R();const fe=async d=>{var n;s.value=!0;try{const b=await ul({serviceId:d.id});console.log(b,"result"),(n=G.value)==null||n.setFrom(b.data,d.id)}catch{se({message:"查询失败",type:"error"})}},Ce=d=>{p.value=d,e.showModal=!0,e.context="是否刷新服务器状态",e.title="信息",e.type=1},oe=async(d,n)=>{p.value=d,e.showModal=!0,e.context=n===0?"是否绑定?":"是否解除绑定?",e.title="信息",e.type=3,e.attrs={postType:n}};let ve=R();const Ve=d=>{var n;S.value=!0,(n=ve.value)==null||n.getCommondInfo(d)};let E=R();const ke=d=>{var n;D.value=!0,(n=E.value)==null||n.getHistoryRecordRow(d)},ge=(d,n)=>{p.value=d,e.showModal=!0,e.context=n===1?"是否开启?":"是否关闭?",e.title="信息",e.type=2,e.attrs={postType:n}};let K=R("www.baidu.com");const Te=d=>{p.value=d,e.showModal=!0,e.title="测试地址",e.width="350",e.type=4,K.value="www.baidu.com"},O=d=>{p.value=d,e.showModal=!0,e.context="确定删除吗？",e.title="信息",e.type=0},_e=async()=>{p.value&&(await ol({id:p.value.id}),F(),e.showModal=!1)},ae=async(d,n)=>{const b=await al({id:d.id,type:n});se({message:b.data.data,type:"success"})},ie=()=>{for(let d in e)d in u?e[d]=u[d]:delete e[d];console.log(e,"tipModalInit")},be=async(d,n)=>{if(d===0)_e();else if(d===1)p.value&&(await rl({serviceId:p.value.id}),e.showModal=!1,F());else if(d===2){if(p.value){try{const b=await sl({id:p.value.id,isSchedule:n.postType});se({message:b.data.result.msg,type:b.data.result.code===200?"success":"error"})}catch{se({message:"操作失败",type:"error"})}e.showModal=!1,F()}}else if(d===3){if(p.value){try{const b=await nl({id:p.value.id,serverBind:n.postType});se({message:b.data.result.msg,type:b.data.result.code===200?"success":"error"})}catch{se({message:"操作失败",type:"error"})}e.showModal=!1,F()}}else d===4&&p.value&&(e.loading=!0,await il({id:p.value.id,link:K.value}),e.loading=!1,e.showModal=!1,F())};return(d,n)=>{const b=pe,re=me,U=ee,Ee=ce,J=Se,Pe=he;return y(),j("div",null,[l(Ee,{inline:!0,model:t(m),class:"demo-form-inline",ref:"formRef"},{default:o(()=>[l(re,{label:"",prop:"value"},{default:o(()=>[l(b,{modelValue:t(m).name,"onUpdate:modelValue":n[0]||(n[0]=r=>t(m).name=r),style:{width:"180px"},placeholder:"请输入关键字",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),l(re,null,{default:o(()=>[l(U,{type:"primary",size:"large",icon:t(ze),onClick:c},{default:o(()=>[w("查询")]),_:1},8,["icon"]),l(U,{size:"large",icon:t(Ue),onClick:v},{default:o(()=>[w("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),l(Pe,{data:t(h),style:{width:"100%"},"row-key":"id","tree-props":{children:"children"},"default-sort":{prop:"sort",order:""},"default-expand-all":"",class:"table-container","table-layout":"auto",border:""},{default:o(()=>[l(J,{prop:"sort",label:"排序","show-overflow-tooltip":"",sortable:""}),l(J,{prop:"name",label:"服务器名",width:"180"}),l(J,{label:"运行状态",prop:"runStatus","show-overflow-tooltip":""},{default:o(r=>[$("span",{class:xe({"color-green":r.row.runStatus==="0","color-orange":r.row.runStatus==="1"})},H(t(V)(r.row.runStatus)),3)]),_:1}),l(J,{prop:"serviceType",label:"服务类型","show-overflow-tooltip":""}),l(J,{prop:"remark",label:"服务备注","show-overflow-tooltip":""}),l(J,{prop:"serverBind",label:"绑定状态","show-overflow-tooltip":""},{default:o(r=>[$("span",{class:xe({"color-green":r.row.serverBind==="0","color-orange":r.row.serverBind==="1"})},H(t(C)(r.row.serverBind)),3)]),_:1}),l(J,{prop:"netStatus",label:"网络状态","show-overflow-tooltip":""},{default:o(r=>[$("span",{class:xe({"color-green":t(k)(r.row).color==="green","color-red":t(k)(r.row).color==="red","color-bule":t(k)(r.row).color==="blue"})},H(t(k)(r.row).label),3)]),_:1}),l(J,{prop:"newTime",label:"最新时间"},{default:o(r=>[$("span",null,H(t(i)(r.row.newTime)),1)]),_:1}),l(J,{prop:"address",label:"操作",width:"450"},{default:o(r=>[$("div",Bl,[r.row.pid==="-1"?(y(),x(U,{key:0,size:"small",type:"success",onClick:P=>B(r.row)},{default:o(()=>[w(" 下级 ")]),_:2},1032,["onClick"])):M("",!0),r.row.pid==="-1"?(y(),x(U,{key:1,size:"small",onClick:P=>de(r.row.id)},{default:o(()=>[w(" 测试流量 ")]),_:2},1032,["onClick"])):M("",!0),r.row.serviceType==="web"?(y(),x(U,{key:2,size:"small",onClick:P=>q(r.row)},{default:o(()=>[w(" 查看日志 ")]),_:2},1032,["onClick"])):M("",!0),l(U,{size:"small",onClick:P=>te(r.row)},{default:o(()=>[w(" 修改 ")]),_:2},1032,["onClick"]),l(U,{size:"small",onClick:P=>fe(r.row)},{default:o(()=>[w(" 修改条件 ")]),_:2},1032,["onClick"]),l(U,{size:"small",onClick:P=>Ce(r.row)},{default:o(()=>[w(" 刷新 ")]),_:2},1032,["onClick"]),r.row.serverBind==="1"?(y(),x(U,{key:3,size:"small",type:"primary",onClick:P=>oe(r.row,0)},{default:o(()=>[w(" 绑定 ")]),_:2},1032,["onClick"])):M("",!0),r.row.serverBind!=="1"?(y(),x(U,{key:4,size:"small",type:"warning",onClick:P=>oe(r.row,1)},{default:o(()=>[w(" 解绑 ")]),_:2},1032,["onClick"])):M("",!0),l(U,{size:"small",onClick:P=>ke(r.row)},{default:o(()=>[w(" 历史记录 ")]),_:2},1032,["onClick"]),r.row.isSchedule==="0"?(y(),x(U,{key:5,size:"small",type:"primary",onClick:P=>ge(r.row,1)},{default:o(()=>[w(" 开启 ")]),_:2},1032,["onClick"])):M("",!0),r.row.isSchedule!=="0"?(y(),x(U,{key:6,size:"small",type:"primary",onClick:P=>ge(r.row,0)},{default:o(()=>[w(" 关闭 ")]),_:2},1032,["onClick"])):M("",!0),r.row.serviceType==="server"&&r.row.isSchedule==="1"?(y(),x(U,{key:7,size:"small",type:"primary",onClick:P=>Te(r.row)},{default:o(()=>[w(" 测试网络 ")]),_:2},1032,["onClick"])):M("",!0),l(U,{size:"small",type:"danger",onClick:P=>O(r.row)},{default:o(()=>[w(" 删除 ")]),_:2},1032,["onClick"]),l(U,{size:"small",type:"success",onClick:P=>Ve(r.row.id)},{default:o(()=>[w(" 命令 ")]),_:2},1032,["onClick"]),l(U,{size:"small",type:"primary",onClick:P=>ae(r.row,1)},{default:o(()=>[w(" 开启服务 ")]),_:2},1032,["onClick"]),l(U,{size:"small",type:"primary",onClick:P=>ae(r.row,2)},{default:o(()=>[w(" 关闭服务 ")]),_:2},1032,["onClick"]),l(U,{size:"small",type:"primary",onClick:P=>ae(r.row,3)},{default:o(()=>[w(" 重启服务 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),l(gl,{currentRow:t(p),"onUpdate:currentRow":n[1]||(n[1]=r=>A(p)?p.value=r:p=r),addType:t(L),"onUpdate:addType":n[2]||(n[2]=r=>A(L)?L.value=r:L=r),onGetTableData:F,ref_key:"addServerRef",ref:Y},null,8,["currentRow","addType"]),l(yl,{ref_key:"modifyConditionRef",ref:G},null,512),l(Vl,{ref_key:"commandRef",ref:ve},null,512),l(ql,{ref_key:"historyRecordRef",ref:E},null,512),t(e).showModal?(y(),x($e,{key:0,showModal:t(e).showModal,"onUpdate:showModal":n[5]||(n[5]=r=>t(e).showModal=r),title:t(e).title,"onUpdate:title":n[6]||(n[6]=r=>t(e).title=r),context:t(e).context,"onUpdate:context":n[7]||(n[7]=r=>t(e).context=r),type:t(e).type,"onUpdate:type":n[8]||(n[8]=r=>t(e).type=r),attrs:t(e).attrs,"onUpdate:attrs":n[9]||(n[9]=r=>t(e).attrs=r),width:t(e).width,"onUpdate:width":n[10]||(n[10]=r=>t(e).width=r),loading:t(e).loading,"onUpdate:loading":n[11]||(n[11]=r=>t(e).loading=r),top:t(e).top,"onUpdate:top":n[12]||(n[12]=r=>t(e).top=r),onCancelModal:ie,onSureModal:be},He({default:o(()=>[t(e).type===4?(y(),j("div",Al,[Gl,l(b,{modelValue:t(K),"onUpdate:modelValue":n[3]||(n[3]=r=>A(K)?K.value=r:K=r),style:{width:"100%"},placeholder:"请输入服务名",size:"large"},null,8,["modelValue"])])):M("",!0),t(e).type===5?(y(),j("div",Hl,[l(b,{modelValue:t(z),"onUpdate:modelValue":n[4]||(n[4]=r=>A(z)?z.value=r:z=r),style:{width:"100%"},rows:20,type:"textarea",placeholder:" "},null,8,["modelValue"])])):M("",!0)]),_:2},[t(e).type===5?{name:"footerBtn",fn:o(()=>[l(U,{type:"primary",onClick:ie,loading:t(e).loading},{default:o(()=>[w(" 关闭")]),_:1},8,["loading"])]),key:"0"}:void 0]),1032,["showModal","title","context","type","attrs","width","loading","top"])):M("",!0),l(Il,{ref_key:"testFlowRef",ref:_,onTestFlow:de},null,512)])}}}),et=X(jl,[["__scopeId","data-v-4613a40b"]]);export{et as default};
