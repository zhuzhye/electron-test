import{_ as w}from"./_plugin-vue_export-helper-CtXoblKC.js";import{_ as y}from"./logo-C4A_ETkD.js";import{h}from"./index-iVhvrsfC.js";import{u as k,i as c,q as T,l as I,d as v,a7 as b,a8 as p,a9 as x,a0 as S,c as _,f as L,w as D,k as f,o as m,e as t,A as E,B as M,g as R,aa as U}from"./index-BvQG103d.js";const $=""+new URL("ytx-DgKbqHLE.png",import.meta.url).href,q=e=>h.request({url:"/dingDingLogin",method:"GET",params:e},{successMessageText:"登录成功",errorMessageText:"登录失败"}),B=()=>h.request({url:"/userInfo",method:"GET"},{errorMessageText:"获取用户信息失败"}),C=(e,o)=>{const s=k();let n=c(!1);return T(()=>{window.DTFrameLogin({id:"login_container",width:300,height:300},{redirect_uri:encodeURIComponent(e.value),client_id:o.value,scope:"openid",response_type:"code",state:"STATE",prompt:"consent"},async i=>{n.value=!0;const{authCode:l,callback:a}=i;console.log(a,"callback");const u=I(),r=await q({authCode:l});r.code===200&&r.data.token?(sessionStorage.setItem("token",r.data.token),u.setToken(r.data.token),s.push("/monitor/tsServices"),window.removeEventListener("message",a)):(s.push("/login"),window.location.reload());const g=await B();g.data&&u.setUserInfo(g.data),n.value=!1},i=>{console.log(`Login Error: ${i}`)})}),{spinning:n}},N=v({name:"Motion",props:{delay:{type:Number,default:50}},render(){const{delay:e}=this,o=b("motion");if(!o)return console.error("v-motion directive is not defined. Make sure it is registered correctly."),p("div",{},this.$slots.default?this.$slots.default():[]);const s=this.$slots.default?this.$slots.default():[];return x(p("div",{},{default:()=>s}),[[o,{initial:{opacity:0,y:150},enter:{opacity:1,y:0,transition:{delay:e}}}]])}}),d=e=>(E("data-v-c7cf7b4f"),e=e(),M(),e),V={class:"login-body"},A=d(()=>t("div",{class:"login-header"},[t("img",{src:y,alt:""}),t("button",{id:"serverbtn"},"xxxxxxxxxxx"),R(" 服务监控平台 ")],-1)),G={class:"QRdingding"},F=d(()=>t("div",{class:"dingText"},[t("img",{class:"ytxImg",src:$,alt:""}),t("span",null,"使用钉钉扫码")],-1)),H=d(()=>t("div",{id:"login_container"},null,-1)),K=[H],Q=v({__name:"index",setup(e){const o=c("dingnxsxidanep0b3uwx"),s=c(window.location.origin+"/#/login");let n=c(!1);return S(async()=>{let{spinning:i}=C(s,o);n.value=i.value}),(i,l)=>{const a=U;return m(),_("div",V,[A,L(f(N),{delay:150},{default:D(()=>[t("div",G,[F,x((m(),_("div",null,K)),[[a,f(n)]])])]),_:1})])}}}),P=w(Q,[["__scopeId","data-v-c7cf7b4f"]]);export{P as default};
